<div class="font-roboto bg-[#fdfdff] py-16 text-[#333] overflow-hidden">
  <div class="text-center px-8 mb-12">
    <div class="max-w-4xl mx-auto">
      <div class="flex items-center justify-center gap-4 mb-4">
        <div
          class="w-[50px] h-[50px] flex items-center justify-center bg-gradient-to-br from-[#ff7f50] to-[#ff6347] rounded-full shadow-lg shadow-[#ff7f50]/30"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="currentColor"
            class="w-[30px] h-[30px] text-white"
          >
            <path
              fill-rule="evenodd"
              d="M8.25 6.75a3.75 3.75 0 1 1 7.5 0 3.75 3.75 0 0 1-7.5 0ZM15.75 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0 .75.75 0 0 1-.416.67c-.941.256-1.809.56-2.652.94a1.5 1.5 0 0 0-.878 1.23l-.02.101a.75.75 0 0 1-.47.658L12 23.25l-1.426-.363a.75.75 0 0 1-.47-.658l-.02-.101a1.5 1.5 0 0 0-.877-1.23c-.844-.38-1.712-.684-2.653-.94a.75.75 0 0 1-.416-.671ZM12 7.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z"
              clip-rule="evenodd"
            />
          </svg>
        </div>
        <h1
          class="text-3xl sm:text-4xl lg:text-5xl font-extrabold font-open-sans text-[#222]"
        >
          <span class="text-[#ff6347]">Community</span> at Work
        </h1>
      </div>
      <p class="text-base sm:text-lg text-[#555] leading-relaxed max-w-2xl mx-auto">
        We work hand-in-hand with barangay officials and municipal departments to
        ensure streamlined digital services and community development.
      </p>
    </div>
  </div>

  <div class="relative mb-12 py-4">
    <div class="overflow-hidden cursor-grab select-none community-carousel-container">
      <div class="flex will-change-transform community-carousel-track">
        <div
          class="flex-shrink-0 w-[min(calc(40vw),380px)] h-[min(calc(25vw),240px)] mx-6 rounded-xl shadow-xl relative transform transition-transform duration-300 ease-in-out opacity-80 hover:opacity-100"
        >
          <img
            src="https://images.unsplash.com/photo-1543269865-cbf427effbad?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=500&q=80"
            alt="Community meeting"
            class="w-full h-full object-cover block rounded-xl pointer-events-none"
          />
          <div
            class="absolute bottom-0 left-0 right-0 p-6 text-center text-white font-semibold text-lg bg-gradient-to-t from-black/80 to-black/0 opacity-0 translate-y-5 transition-all duration-300 ease-in-out z-10"
          >
            MATAZAC
          </div>
        </div>
        <div
          class="flex-shrink-0 w-[min(calc(40vw),380px)] h-[min(calc(25vw),240px)] mx-6 rounded-xl shadow-xl relative transform transition-transform duration-300 ease-in-out opacity-80 hover:opacity-100"
        >
          <img
            src="https://images.unsplash.com/photo-1522071820081-009f0129c71c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=500&q=80"
            alt="Digital workshop"
            class="w-full h-full object-cover block rounded-xl pointer-events-none"
          />
          <div
            class="absolute bottom-0 left-0 right-0 p-6 text-center text-white font-semibold text-lg bg-gradient-to-t from-black/80 to-black/0 opacity-0 translate-y-5 transition-all duration-300 ease-in-out z-10"
          >
            NANGLATIYON
          </div>
        </div>
        <div
          class="flex-shrink-0 w-[min(calc(40vw),380px)] h-[min(calc(25vw),240px)] mx-6 rounded-xl shadow-xl relative transform transition-transform duration-300 ease-in-out opacity-80 hover:opacity-100"
        >
          <img
            src="https://images.unsplash.com/photo-1568992687947-868a62a9f521?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=500&q=80"
            alt="Town planning"
            class="w-full h-full object-cover block rounded-xl pointer-events-none"
          />
          <div
            class="absolute bottom-0 left-0 right-0 p-6 text-center text-white font-semibold text-lg bg-gradient-to-t from-black/80 to-black/0 opacity-0 translate-y-5 transition-all duration-300 ease-in-out z-10"
          >
            JULIANA
          </div>
        </div>
        <div
          class="flex-shrink-0 w-[min(calc(40vw),380px)] h-[min(calc(25vw),240px)] mx-6 rounded-xl shadow-xl relative transform transition-transform duration-300 ease-in-out opacity-80 hover:opacity-100"
        >
          <img
            src="https://images.unsplash.com/photo-1522071820081-009f0129c71c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=500&q=80"
            alt="Digital workshop"
            class="w-full h-full object-cover block rounded-xl pointer-events-none"
          />
          <div
            class="absolute bottom-0 left-0 right-0 p-6 text-center text-white font-semibold text-lg bg-gradient-to-t from-black/80 to-black/0 opacity-0 translate-y-5 transition-all duration-300 ease-in-out z-10"
          >
            NANGLATIYON
          </div>
        </div>
        <div
          class="flex-shrink-0 w-[min(calc(40vw),380px)] h-[min(calc(25vw),240px)] mx-6 rounded-xl shadow-xl relative transform transition-transform duration-300 ease-in-out opacity-80 hover:opacity-100"
        >
          <img
            src="https://images.unsplash.com/photo-1552664730-d307ca884978?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=500&q=80"
            alt="Education program"
            class="w-full h-full object-cover block rounded-xl pointer-events-none"
          />
          <div
            class="absolute bottom-0 left-0 right-0 p-6 text-center text-white font-semibold text-lg bg-gradient-to-t from-black/80 to-black/0 opacity-0 translate-y-5 transition-all duration-300 ease-in-out z-10"
          >
            MAGAZINE
          </div>
        </div>
        <div
          class="flex-shrink-0 w-[min(calc(40vw),380px)] h-[min(calc(25vw),240px)] mx-6 rounded-xl shadow-xl relative transform transition-transform duration-300 ease-in-out opacity-80 hover:opacity-100"
        >
          <img
            src="https://images.unsplash.com/photo-1532629345422-7515f3d16bb6?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=500&q=80"
            alt="Environment project"
            class="w-full h-full object-cover block rounded-xl pointer-events-none"
          />
          <div
            class="absolute bottom-0 left-0 right-0 p-6 text-center text-white font-semibold text-lg bg-gradient-to-t from-black/80 to-black/0 opacity-0 translate-y-5 transition-all duration-300 ease-in-out z-10"
          >
            SALVIN
          </div>
        </div>
        <div
          class="flex-shrink-0 w-[min(calc(40vw),380px)] h-[min(calc(25vw),240px)] mx-6 rounded-xl shadow-xl relative transform transition-transform duration-300 ease-in-out opacity-80 hover:opacity-100"
        >
          <img
            src="https://images.unsplash.com/photo-1543269865-cbf427effbad?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=500&q=80"
            alt="Community meeting"
            class="w-full h-full object-cover block rounded-xl pointer-events-none"
          />
          <div
            class="absolute bottom-0 left-0 right-0 p-6 text-center text-white font-semibold text-lg bg-gradient-to-t from-black/80 to-black/0 opacity-0 translate-y-5 transition-all duration-300 ease-in-out z-10"
          >
            MATAZAC
          </div>
        </div>
        <div
          class="flex-shrink-0 w-[min(calc(40vw),380px)] h-[min(calc(25vw),240px)] mx-6 rounded-xl shadow-xl relative transform transition-transform duration-300 ease-in-out opacity-80 hover:opacity-100"
        >
          <img
            src="https://images.unsplash.com/photo-1522071820081-009f0129c71c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=500&q=80"
            alt="Digital workshop"
            class="w-full h-full object-cover block rounded-xl pointer-events-none"
          />
          <div
            class="absolute bottom-0 left-0 right-0 p-6 text-center text-white font-semibold text-lg bg-gradient-to-t from-black/80 to-black/0 opacity-0 translate-y-5 transition-all duration-300 ease-in-out z-10"
          >
            NANGLATIYON
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="w-11/12 max-w-md mx-auto mt-10 h-1.5 bg-[#e9e9e9] rounded-full overflow-hidden">
    <div
      class="h-full bg-gradient-to-r from-[#ff7f50] to-[#ff6347] w-0 rounded-full transition-all duration-200 ease-out community-progress-bar"
    ></div>
  </div>

  <div
    class="mt-12 text-center text-[#777] text-sm px-8 pt-4 border-t border-[#eee] max-w-4xl mx-auto"
  >
    <p>
      Building stronger communities through
      <span class="text-[#ff6347] font-semibold">collaboration</span> and
      <span class="text-[#ff6347] font-semibold">innovation</span> since 2023
    </p>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const container = document.querySelector('.community-carousel-container');
    const track = document.querySelector('.community-carousel-track');
    const originalItems = Array.from(track.children);
    const progressBar = document.querySelector('.community-progress-bar');

    if (!container || !track || originalItems.length === 0) return;

    // --- Config ---
    const TRANSITION_SPEED_MS = 300; // Faster transition
    const AUTOPLAY_DELAY_MS = 2000; // Faster autoplay
    const CLONE_COUNT = Math.max(originalItems.length, 5);

    // --- State ---
    let currentIndex = CLONE_COUNT;
    let autoplayInterval;
    let isDragging = false;
    let startPos = 0;
    let currentTranslate = 0;
    let prevTranslate = 0;
    let animationID = 0;

    // --- Setup ---
    const setup = () => {
      cloneItems();
      setupEventListeners();
      startAutoplay();
      updatePosition(false); // Set initial position
      window.addEventListener('resize', () => updatePosition(false));
    };

    const cloneItems = () => {
      const clonesEnd = originalItems.map((item) => item.cloneNode(true));
      const clonesStart = originalItems.map((item) => item.cloneNode(true)).reverse();
      track.append(...clonesEnd);
      track.prepend(...clonesStart);
    };

    const setupEventListeners = () => {
      track.addEventListener('transitionend', handleTransitionEnd);
      container.addEventListener('mouseenter', stopAutoplay);
      container.addEventListener('mouseleave', startAutoplay);

      // Touch and Mouse events for dragging
      container.addEventListener('mousedown', dragStart);
      container.addEventListener('touchstart', dragStart, { passive: true });
      container.addEventListener('mouseup', dragEnd);
      container.addEventListener('mouseleave', dragEnd);
      container.addEventListener('touchend', dragEnd);
      container.addEventListener('mousemove', drag);
      container.addEventListener('touchmove', drag, { passive: true });
    };

    // --- Event Handlers (Drag & Snap) ---
    const dragStart = (event) => {
      isDragging = true;
      startPos = getPositionX(event);
      prevTranslate = currentTranslate;
      animationID = requestAnimationFrame(animationLoop);
      track.style.transition = 'none';
      container.classList.add('is-dragging');
      stopAutoplay();
    };

    const drag = (event) => {
      if (!isDragging) return;
      const currentPosition = getPositionX(event);
      currentTranslate = prevTranslate + currentPosition - startPos;
    };

    const dragEnd = () => {
      if (!isDragging) return;
      isDragging = false;
      cancelAnimationFrame(animationID);
      container.classList.remove('is-dragging');

      const movedBy = currentTranslate - prevTranslate;
      if (movedBy < -50) {
        currentIndex++;
      } else if (movedBy > 50) {
        currentIndex--;
      }

      updatePosition(true); // Snap to the new index
      startAutoplay();
    };

    const animationLoop = () => {
      setTransform(currentTranslate);
      if (isDragging) requestAnimationFrame(animationLoop);
    };

    const getPositionX = (event) => (event.touches ? event.touches[0].clientX : event.clientX);

    const handleTransitionEnd = () => {
      if (currentIndex < CLONE_COUNT) {
        currentIndex += originalItems.length;
        updatePosition(false);
      } else if (currentIndex >= CLONE_COUNT + originalItems.length) {
        currentIndex -= originalItems.length;
        updatePosition(false);
      }
    };

    // --- Core Logic ---
    const updatePosition = (enableTransition = true) => {
      const itemWidth = originalItems[0].offsetWidth;
      const margin = parseFloat(getComputedStyle(originalItems[0]).marginRight) * 2;
      const totalItemWidth = itemWidth + margin;
      const offset = container.clientWidth / 2 - totalItemWidth / 2;

      currentTranslate = -currentIndex * totalItemWidth + offset;
      prevTranslate = currentTranslate;

      track.style.transition = enableTransition
        ? `transform ${TRANSITION_SPEED_MS}ms cubic-bezier(0.65, 0, 0.35, 1)`
        : 'none';
      setTransform(currentTranslate);

      updateUI();
    };

    // --- UI Updates ---
    const updateUI = () => {
      // Scale and Opacity
      const allItems = Array.from(track.children);
      allItems.forEach((item, index) => {
        const isActive = Math.abs(index - currentIndex) < 1;
        const isNearby = Math.abs(index - currentIndex) < 2;
        const imageLabel = item.querySelector('.absolute'); // Select the image label
        
        // Reset all styles before applying new ones to avoid conflicts
        item.style.transform = '';
        item.style.opacity = '';
        item.style.zIndex = '';
        if (imageLabel) {
            imageLabel.style.opacity = '';
            imageLabel.style.transform = '';
        }


        if (isActive) {
          item.classList.add('scale-105', 'opacity-100', 'z-10');
          item.classList.remove('scale-95', 'opacity-80', 'z-5', 'scale-90', 'opacity-60', 'z-1');
          if (imageLabel) {
            imageLabel.classList.add('opacity-100', 'translate-y-0');
            imageLabel.classList.remove('opacity-0', 'translate-y-5');
          }
        } else if (isNearby) {
          item.classList.add('scale-95', 'opacity-80', 'z-5');
          item.classList.remove('scale-105', 'opacity-100', 'z-10', 'scale-90', 'opacity-60', 'z-1');
          if (imageLabel) {
            imageLabel.classList.add('opacity-0', 'translate-y-5'); // Ensure it's hidden
            imageLabel.classList.remove('opacity-100', 'translate-y-0');
          }
        } else {
          item.classList.add('scale-90', 'opacity-60', 'z-1');
          item.classList.remove('scale-105', 'opacity-100', 'z-10', 'scale-95', 'opacity-80', 'z-5');
          if (imageLabel) {
            imageLabel.classList.add('opacity-0', 'translate-y-5'); // Ensure it's hidden
            imageLabel.classList.remove('opacity-100', 'translate-y-0');
          }
        }
      });

      // Progress Bar
      const realIndex = (currentIndex - CLONE_COUNT + originalItems.length) % originalItems.length;
      progressBar.style.width = `${((realIndex + 1) / originalItems.length) * 100}%`;
    };

    const setTransform = (x) => {
      track.style.transform = `translateX(${x}px)`;
    };

    // --- Autoplay ---
    const startAutoplay = () => {
      stopAutoplay();
      autoplayInterval = setInterval(() => {
        currentIndex++;
        updatePosition(true);
      }, AUTOPLAY_DELAY_MS);
    };

    const stopAutoplay = () => {
      clearInterval(autoplayInterval);
    };

    // --- Start the show ---
    setup();
  });
</script>